# 知识图谱系统需求文档 v1.0

## 1. 项目概述

### 1.1 项目背景
基于TypeScript与AWS Serverless构建一个功能完备、成本可控的知识图谱系统，将Whimsical脑图等非结构化知识转化为结构化、可查询、AI增强的智能资产。

### 1.2 核心价值主张
- **成本效益**: 采用AWS Serverless架构，按需付费，降低运维成本
- **智能交互**: 集成LLM实现自然语言查询与分析
- **高保真转换**: 通过SVG解析保留脑图的完整语义信息
- **可扩展性**: 模块化设计支持多种数据源扩展

### 1.3 技术栈
- **前端**: TypeScript, React/Vue.js
- **后端**: AWS Lambda (TypeScript)
- **数据库**: Amazon DynamoDB
- **AI服务**: Amazon Bedrock / OpenAI API
- **基础设施**: AWS CDK/Terraform

## 2. 功能需求

### 2.1 数据抽取模块 (MindMapParserFunction)

#### 2.1.1 核心功能
- [ ] **SVG解析引擎**
  - 支持Whimsical脑图SVG导出解析
  - 提取节点信息（ID、位置、颜色、文本、形状）
  - 提取边信息（连接关系、标签、样式）
  - 支持无头浏览器自动化获取SVG

- [ ] **数据转换层**
  - 将SVG元素转换为标准图数据模型
  - 支持graphology库进行内存图构建
  - 数据清洗与验证
  - 错误处理与日志记录

#### 2.1.2 输入输出
- **输入**: Whimsical脑图URL或SVG文件
- **输出**: 标准化的图数据结构（节点+边）

#### 2.1.3 性能要求
- 单个脑图解析时间 < 30秒
- 支持最大1000个节点的脑图
- 内存使用 < 512MB

### 2.2 图数据存储模块 (DynamoDB Schema)

#### 2.2.1 数据模型设计
- [ ] **邻接表模式实现**
  - 节点项目: PK=`NODE#<nodeId>`, SK=`METADATA#<nodeId>`
  - 边项目: PK=`NODE#<sourceId>`, SK=`EDGE#<type>#<targetId>`
  - GSI反向索引: GSI1PK=`NODE#<targetId>`, GSI1SK=`EDGE#<type>#<sourceId>`

- [ ] **数据持久化**
  - 批量写入优化（BatchWriteItem）
  - 事务性操作支持
  - 数据版本控制
  - 软删除机制

#### 2.2.2 存储要求
- 支持10万+节点存储
- 单节点最大连接数: 1000
- 数据一致性保证
- 备份与恢复机制

### 2.3 图查询模块 (GraphQueryFunction)

#### 2.3.1 查询功能
- [ ] **基础查询**
  - 节点详情查询
  - 一跳邻居查询（出边+入边）
  - 节点存在性检查
  - 关系类型统计

- [ ] **高级查询**
  - 多跳遍历（N-Hop Traversal）
  - 路径查找
  - 子图提取
  - 图统计分析

#### 2.3.2 性能优化
- 查询结果缓存
- 分页处理机制
- 并发查询支持
- 查询超时控制

### 2.4 智能交互模块 (KnowledgeAgentFunction)

#### 2.4.1 自然语言处理
- [ ] **查询理解**
  - 自然语言到图查询转换
  - 意图识别与实体抽取
  - 查询计划生成
  - 多轮对话支持

- [ ] **答案生成**
  - Graph-RAG实现
  - 上下文增强生成
  - 答案可信度评估
  - 引用来源追踪

#### 2.4.2 LLM集成
- 支持多种LLM提供商（OpenAI, Bedrock, Claude）
- Prompt工程优化
- Token使用优化
- 错误处理与降级

## 3. 非功能需求

### 3.1 性能需求
- **响应时间**
  - 简单查询: < 500ms
  - 复杂查询: < 5s
  - 数据导入: < 2min/1000节点

- **并发能力**
  - 支持100并发用户
  - 查询QPS: 1000+
  - 数据导入并发: 10

### 3.2 可用性需求
- 系统可用性: 99.9%
- 故障恢复时间: < 5min
- 数据备份频率: 每日
- 灾难恢复RTO: < 1小时

### 3.3 安全需求
- 用户认证与授权
- API访问控制
- 数据加密（传输+存储）
- 审计日志记录

### 3.4 成本需求
- 月度运营成本 < $100（1万次查询）
- 按需扩展，无固定成本
- 资源使用监控与优化

## 4. 系统架构

### 4.1 整体架构
```
[用户界面] → [API Gateway] → [Lambda Functions] → [DynamoDB]
                                     ↓
                              [LLM Services]
```

### 4.2 核心组件
1. **MindMapParserFunction**: 数据抽取与转换
2. **GraphQueryFunction**: 图数据查询
3. **KnowledgeAgentFunction**: 智能问答
4. **DynamoDB**: 图数据存储
5. **API Gateway**: 统一API入口

### 4.3 数据流
1. 脑图导入 → SVG解析 → 图构建 → 数据存储
2. 用户查询 → 意图理解 → 图查询 → 结果生成 → 答案返回

## 5. 开发计划

### 5.1 第一阶段 (MVP - 4周)
- [ ] DynamoDB表结构设计与创建
- [ ] 基础的SVG解析功能
- [ ] 简单的图查询API
- [ ] 基本的Web界面

### 5.2 第二阶段 (核心功能 - 6周)
- [ ] 完整的数据抽取管道
- [ ] 高级图查询功能
- [ ] LLM集成与基础问答
- [ ] 用户认证系统

### 5.3 第三阶段 (优化增强 - 4周)
- [ ] 性能优化与缓存
- [ ] 高级RAG功能
- [ ] 监控与日志系统
- [ ] 文档与测试完善

## 6. 验收标准

### 6.1 功能验收
- [ ] 成功解析包含50+节点的Whimsical脑图
- [ ] 支持复杂的多跳图查询
- [ ] 自然语言问答准确率 > 85%
- [ ] 完整的CRUD操作支持

### 6.2 性能验收
- [ ] 单次查询响应时间达标
- [ ] 并发负载测试通过
- [ ] 成本控制在预算范围内

### 6.3 质量验收
- [ ] 代码覆盖率 > 80%
- [ ] 安全扫描无高危漏洞
- [ ] 用户体验测试通过

## 7. 风险与缓解

### 7.1 技术风险
- **SVG解析复杂性**: 建立测试用例库，渐进式开发
- **DynamoDB性能瓶颈**: 设计分片策略，监控热点分区
- **LLM成本控制**: 实现缓存机制，优化Prompt设计

### 7.2 业务风险
- **需求变更**: 采用敏捷开发，定期评审
- **用户接受度**: 早期用户测试，快速迭代

## 8. 后续迭代方向

### 8.1 功能扩展
- 支持更多数据源（Markdown、Notion等）
- 多模态知识图谱（图像、视频）
- 协作编辑功能
- 知识图谱可视化

### 8.2 技术演进
- 迁移到Step Functions处理复杂遍历
- 实现迭代式RAG（KnowTrace模式）
- 引入图神经网络
- 边缘计算优化

---

**文档版本**: v1.0  
**创建日期**: 2024-06-24  
**负责人**: [待填写]  
**审核人**: [待填写]
